<form ng-submit="FormCtrl.send()" name="betterform" class="form-horizontal" novalidate>
    <select name="ptpage" ng-model="PageCtrl.model.data.ptpage" ng-options="value as label for (label,value) in FormCtrl.choices"></select>

    <fieldset>
        <legend>To</legend>
        <div class="row">
            <form-input reference="no"></form-input>
        </div>
    </fieldset>

    <fieldset ng-if="PageCtrl.model.data.ptpage">
        <legend>From</legend>
        <div class="row">
            <form-input reference="caller" half></form-input>
            <form-input reference="phone" half></form-input>
        </div>
        <div class="form-group">
            <label for="reply">Response required? <input id="reply" name="reply" ng-model="PageCtrl.model.data.reply" type="checkbox" /></label>
            <label ng-show="PageCtrl.model.data.reply" for="within">within <input id="within" name="within" type="number" ng-model="PageCtrl.model.data.within" ng-required="PageCtrl.model.data.reply" min="1" max="99" ng-pattern="/^[0-9]+$/" /> mins</label>
            <div ng-if="betterform.within.$touched && betterform.within.$dirty" ng-messages="betterform.within.$error">
                <span ng-message="required"><em>Response time</em> is required</span>
                <span ng-message="number"><em>Response time</em> must be an number</span>
                <span ng-message="pattern"><em>Response time</em> must be an integer</span>
                <span ng-message="min"><em>Response time</em> must be greater than 0</span>
                <span ng-message="max"><em>Response time</em> must be less than 100</span>
            </div>
        </div>
    </fieldset>

    <fieldset ng-if="PageCtrl.model.data.ptpage">
        <legend>Patient</legend>
        <div class="row">
            <form-input reference="patient" half></form-input>
            <form-input reference="nhi" half></form-input>
        </div>
        <div class="row">
            <form-input reference="ward" half></form-input>
            <form-input reference="bed" half></form-input>
        </div>
    </fieldset>

    <fieldset ng-if="PageCtrl.model.data.ptpage">
        <legend>Details</legend>
        <div class="form-group">
            <select id="why" name="why" ng-model="PageCtrl.model.data.why" ng-options="reason as reason group by extra.group for (reason,extra) in FormCtrl.reasons" required>
                <option value="" selected>Reason for page</option>
            </select>
            <div ng-if="betterform.why.$touched && betterform.why.$dirty" ng-messages="betterform.why.$error">
                <span ng-message="required"><em>Reason for page</em> is required</span>
            </div>
        </div>
        <div class="form-group">
            <input id="details" name="details" ng-model="PageCtrl.model.data.details" placeholder="Specify (optional)" />
        </div>
    </fieldset>

    <fieldset ng-if="!PageCtrl.model.data.ptpage">
        <legend>Contents</legend>
        <div class="form-group">
            <textarea id="contents" name="contents" ng-model="PageCtrl.model.data.contents" required></textarea>
            <div ng-if="betterform.contents.$touched && betterform.contents.$dirty" ng-messages="betterform.contents.$error">
                <span ng-message="required"><em>Contents</em> is required</span>
            </div>
        </div>
        <div class="form-group">
            <label for="private">Do not log this page <input id="private" name="private" ng-model="PageCtrl.model.data.private" type="checkbox" /></label>
        </div>
    </fieldset>

    <div class="form-group">
        <input id="submit" ng-disabled="betterform.$invalid || PageCtrl.overflow" type="submit" value="{{ PageCtrl.overflow ? 'Character limit exceeded' : 'Send' }}" />
        <button id="reset" type="button" ng-click="FormCtrl.reset()">Reset</button>
    </div>
</form>