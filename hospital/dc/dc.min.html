<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Discharge Summary</title><script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script><script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.13/angular-animate.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.0/ui-bootstrap-tpls.min.js"></script><script>!function(){"use strict";angular.module("ui.tree",[]).constant("treeConfig",{treeClass:"angular-ui-tree",emptyTreeClass:"angular-ui-tree-empty",hiddenClass:"angular-ui-tree-hidden",nodesClass:"angular-ui-tree-nodes",nodeClass:"angular-ui-tree-node",handleClass:"angular-ui-tree-handle",placeHolderClass:"angular-ui-tree-placeholder",dragClass:"angular-ui-tree-drag",dragThreshold:3,levelThreshold:30})}(),function(){"use strict";angular.module("ui.tree").controller("TreeHandleController",["$scope","$element",function(e,n){this.scope=e,e.$element=n,e.$nodeScope=null,e.$type="uiTreeHandle"}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeNodeController",["$scope","$element",function(e,n){function t(e){var n,l,r=0,i=e.childNodes();for(n=0;n<i.length;n++)l=i[n].$childNodesScope,l&&(r=1,t(l));o+=r}this.scope=e,e.$element=n,e.$modelValue=null,e.$parentNodeScope=null,e.$childNodesScope=null,e.$parentNodesScope=null,e.$treeScope=null,e.$handleScope=null,e.$type="uiTreeNode",e.$$apply=!1,e.collapsed=!1,e.init=function(t){var o=t[0];e.$treeScope=t[1]?t[1].scope:null,e.$parentNodeScope=o.scope.$nodeScope,e.$modelValue=o.scope.$modelValue[e.$index],e.$parentNodesScope=o.scope,o.scope.initSubNode(e),n.on("$destroy",function(){o.scope.destroySubNode(e)})},e.index=function(){return e.$parentNodesScope.$modelValue.indexOf(e.$modelValue)},e.dragEnabled=function(){return!(e.$treeScope&&!e.$treeScope.dragEnabled)},e.isSibling=function(n){return e.$parentNodesScope==n.$parentNodesScope},e.isChild=function(n){var t=e.childNodes();return t&&t.indexOf(n)>-1},e.prev=function(){var n=e.index();return n>0?e.siblings()[n-1]:null},e.siblings=function(){return e.$parentNodesScope.childNodes()},e.childNodesCount=function(){return e.childNodes()?e.childNodes().length:0},e.hasChild=function(){return e.childNodesCount()>0},e.childNodes=function(){return e.$childNodesScope&&e.$childNodesScope.$modelValue?e.$childNodesScope.childNodes():null},e.accept=function(n,t){return e.$childNodesScope&&e.$childNodesScope.$modelValue&&e.$childNodesScope.accept(n,t)},e.removeNode=function(){var n=e.remove();return e.$callbacks.removed(n),n},e.remove=function(){return e.$parentNodesScope.removeNode(e)},e.toggle=function(){e.collapsed=!e.collapsed},e.collapse=function(){e.collapsed=!0},e.expand=function(){e.collapsed=!1},e.depth=function(){var n=e.$parentNodeScope;return n?n.depth()+1:1};var o=0;e.maxSubDepth=function(){return o=0,e.$childNodesScope&&t(e.$childNodesScope),o}}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeNodesController",["$scope","$element",function(e,n){this.scope=e,e.$element=n,e.$modelValue=null,e.$nodeScope=null,e.$treeScope=null,e.$type="uiTreeNodes",e.$nodesMap={},e.nodropEnabled=!1,e.maxDepth=0,e.cloneEnabled=!1,e.initSubNode=function(n){return n.$modelValue?void(e.$nodesMap[n.$modelValue.$$hashKey]=n):null},e.destroySubNode=function(n){return n.$modelValue?void(e.$nodesMap[n.$modelValue.$$hashKey]=null):null},e.accept=function(n,t){return e.$treeScope.$callbacks.accept(n,e,t)},e.beforeDrag=function(n){return e.$treeScope.$callbacks.beforeDrag(n)},e.isParent=function(n){return n.$parentNodesScope==e},e.hasChild=function(){return e.$modelValue.length>0},e.safeApply=function(e){var n=this.$root.$$phase;"$apply"==n||"$digest"==n?e&&"function"==typeof e&&e():this.$apply(e)},e.removeNode=function(n){var t=e.$modelValue.indexOf(n.$modelValue);return t>-1?(e.safeApply(function(){e.$modelValue.splice(t,1)[0]}),n):null},e.insertNode=function(n,t){e.safeApply(function(){e.$modelValue.splice(n,0,t)})},e.childNodes=function(){var n,t=[];if(e.$modelValue)for(n=0;n<e.$modelValue.length;n++)t.push(e.$nodesMap[e.$modelValue[n].$$hashKey]);return t},e.depth=function(){return e.$nodeScope?e.$nodeScope.depth():0},e.outOfDepth=function(n){var t=e.maxDepth||e.$treeScope.maxDepth;return t>0?e.depth()+n.maxSubDepth()+1>t:!1}}])}(),function(){"use strict";angular.module("ui.tree").controller("TreeController",["$scope","$element",function(e,n){this.scope=e,e.$element=n,e.$nodesScope=null,e.$type="uiTree",e.$emptyElm=null,e.$callbacks=null,e.dragEnabled=!0,e.emptyPlaceHolderEnabled=!0,e.maxDepth=0,e.dragDelay=0,e.cloneEnabled=!1,e.nodropEnabled=!1,e.isEmpty=function(){return e.$nodesScope&&e.$nodesScope.$modelValue&&0===e.$nodesScope.$modelValue.length},e.place=function(n){e.$nodesScope.$element.append(n),e.$emptyElm.remove()},e.resetEmptyElement=function(){0===e.$nodesScope.$modelValue.length&&e.emptyPlaceHolderEnabled?n.append(e.$emptyElm):e.$emptyElm.remove()};var t=function(e,n){var o,l,r=e.childNodes();for(o=0;o<r.length;o++)n?r[o].collapse():r[o].expand(),l=r[o].$childNodesScope,l&&t(l,n)};e.collapseAll=function(){t(e.$nodesScope,!0)},e.expandAll=function(){t(e.$nodesScope,!1)}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTree",["treeConfig","$window",function(e,n){return{restrict:"A",scope:!0,controller:"TreeController",link:function(t,o,l){var r={accept:null,beforeDrag:null},i={};angular.extend(i,e),i.treeClass&&o.addClass(i.treeClass),t.$emptyElm=angular.element(n.document.createElement("div")),i.emptyTreeClass&&t.$emptyElm.addClass(i.emptyTreeClass),t.$watch("$nodesScope.$modelValue.length",function(){t.$nodesScope.$modelValue&&t.resetEmptyElement()},!0),t.$watch(l.dragEnabled,function(e){"boolean"==typeof e&&(t.dragEnabled=e)}),t.$watch(l.emptyPlaceHolderEnabled,function(e){"boolean"==typeof e&&(t.emptyPlaceHolderEnabled=e)}),t.$watch(l.nodropEnabled,function(e){"boolean"==typeof e&&(t.nodropEnabled=e)}),t.$watch(l.cloneEnabled,function(e){"boolean"==typeof e&&(t.cloneEnabled=e)}),t.$watch(l.maxDepth,function(e){"number"==typeof e&&(t.maxDepth=e)}),t.$watch(l.dragDelay,function(e){"number"==typeof e&&(t.dragDelay=e)}),r.accept=function(e,n,t){return n.nodropEnabled||n.outOfDepth(e)?!1:!0},r.beforeDrag=function(e){return!0},r.removed=function(e){},r.dropped=function(e){},r.dragStart=function(e){},r.dragMove=function(e){},r.dragStop=function(e){},r.beforeDrop=function(e){},t.$watch(l.uiTree,function(e,n){angular.forEach(e,function(e,n){r[n]&&"function"==typeof e&&(r[n]=e)}),t.$callbacks=r},!0)}}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTreeHandle",["treeConfig",function(e){return{require:"^uiTreeNode",restrict:"A",scope:!0,controller:"TreeHandleController",link:function(n,t,o,l){var r={};angular.extend(r,e),r.handleClass&&t.addClass(r.handleClass),n!=l.scope&&(n.$nodeScope=l.scope,l.scope.$handleScope=n)}}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTreeNode",["treeConfig","$uiTreeHelper","$window","$document","$timeout",function(e,n,t,o,l){return{require:["^uiTreeNodes","^uiTree"],restrict:"A",controller:"TreeNodeController",link:function(r,i,a,d){var c,s,u,p,f,$,m,h,g,b,y,S,v,N,x,C,E,T,w,D={},X="ontouchstart"in window,Y=null,A=document.body,V=document.documentElement;angular.extend(D,e),D.nodeClass&&i.addClass(D.nodeClass),r.init(d),r.collapsed=!!n.getNodeAttribute(r,"collapsed"),r.$watch(a.collapsed,function(e){"boolean"==typeof e&&(r.collapsed=e)}),r.$watch("collapsed",function(e){n.setNodeAttribute(r,"collapsed",e),a.$set("collapsed",e)}),b=function(e){if((X||2!=e.button&&3!=e.which)&&!(e.uiTreeDragging||e.originalEvent&&e.originalEvent.uiTreeDragging)){var l,a,d,b,y,S=angular.element(e.target),v=S.scope();if(v&&v.$type&&!("uiTreeNode"!=v.$type&&"uiTreeHandle"!=v.$type||"uiTreeNode"==v.$type&&v.$handleScope||(l=S.prop("tagName").toLowerCase(),"input"==l||"textarea"==l||"button"==l||"select"==l))){for(;S&&S[0]&&S[0]!=i;){if(n.nodrag(S))return;S=S.parent()}r.beforeDrag(r)&&(e.uiTreeDragging=!0,e.originalEvent&&(e.originalEvent.uiTreeDragging=!0),e.preventDefault(),d=n.eventObj(e),c=!0,s=n.dragInfo(r),r.$apply(function(){r.$callbacks.dragStart(s.eventArgs(m,u))}),a=r.$element.prop("tagName"),"tr"===a.toLowerCase()?(p=angular.element(t.document.createElement(a)),b=angular.element(t.document.createElement("td")).addClass(D.placeHolderClass),p.append(b)):p=angular.element(t.document.createElement(a)).addClass(D.placeHolderClass),f=angular.element(t.document.createElement(a)),D.hiddenClass&&f.addClass(D.hiddenClass),u=n.positionStarted(d,r.$element),p.css("height",n.height(r.$element)+"px"),$=angular.element(t.document.createElement(r.$parentNodesScope.$element.prop("tagName"))).addClass(r.$parentNodesScope.$element.attr("class")).addClass(D.dragClass),$.css("width",n.width(r.$element)+"px"),$.css("z-index",9999),y=(r.$element[0].querySelector(".angular-ui-tree-handle")||r.$element[0]).currentStyle,y&&(document.body.setAttribute("ui-tree-cursor",o.find("body").css("cursor")||""),o.find("body").css({cursor:y.cursor+"!important"})),r.$element.after(p),r.$element.after(f),$.append(r.$element),o.find("body").append($),$.css({left:d.pageX-u.offsetX+"px",top:d.pageY-u.offsetY+"px"}),m={placeholder:p,dragging:$},angular.element(o).bind("touchend",x),angular.element(o).bind("touchcancel",x),angular.element(o).bind("touchmove",N),angular.element(o).bind("mouseup",x),angular.element(o).bind("mousemove",N),angular.element(o).bind("mouseleave",C),h=Math.max(A.scrollHeight,A.offsetHeight,V.clientHeight,V.scrollHeight,V.offsetHeight),g=Math.max(A.scrollWidth,A.offsetWidth,V.clientWidth,V.scrollWidth,V.offsetWidth))}}},y=function(e){var o,l,i,a,d,f,b,y,S,v,N,x,C,E,T,w,X=n.eventObj(e);if($){if(e.preventDefault(),t.getSelection?t.getSelection().removeAllRanges():t.document.selection&&t.document.selection.empty(),i=X.pageX-u.offsetX,a=X.pageY-u.offsetY,0>i&&(i=0),0>a&&(a=0),a+10>h&&(a=h-10),i+10>g&&(i=g-10),$.css({left:i+"px",top:a+"px"}),d=window.pageYOffset||t.document.documentElement.scrollTop,f=d+(window.innerHeight||t.document.clientHeight||t.document.clientHeight),f<X.pageY&&h>=f&&window.scrollBy(0,10),d>X.pageY&&window.scrollBy(0,-10),n.positionMoved(e,u,c),c)return void(c=!1);if(u.dirAx&&u.distAxX>=D.levelThreshold&&(u.distAxX=0,u.distX>0&&(o=s.prev(),o&&!o.collapsed&&o.accept(r,o.childNodesCount())&&(o.$childNodesScope.$element.append(p),s.moveTo(o.$childNodesScope,o.childNodes(),o.childNodesCount()))),u.distX<0&&(l=s.next(),l||(b=s.parentNode(),b&&b.$parentNodesScope.accept(r,b.index()+1)&&(b.$element.after(p),s.moveTo(b.$parentNodesScope,b.siblings(),b.index()+1))))),y=n.offset($).left-n.offset(p).left>=D.threshold,S=X.pageX-t.document.body.scrollLeft,v=X.pageY-(window.pageYOffset||t.document.documentElement.scrollTop),angular.isFunction($.hide)?$.hide():(N=$[0].style.display,$[0].style.display="none"),t.document.elementFromPoint(S,v),C=angular.element(t.document.elementFromPoint(S,v)),angular.isFunction($.show)?$.show():$[0].style.display=N,!u.dirAx){if(x=C.scope(),E=!1,!x)return;if("uiTree"==x.$type&&x.dragEnabled&&(E=x.isEmpty()),"uiTreeHandle"==x.$type&&(x=x.$nodeScope),"uiTreeNode"!=x.$type&&!E)return;Y&&p.parent()[0]!=Y.$element[0]&&(Y.resetEmptyElement(),Y=null),E?(Y=x,x.$nodesScope.accept(r,0)&&(x.place(p),s.moveTo(x.$nodesScope,x.$nodesScope.childNodes(),0))):x.dragEnabled()&&(C=x.$element,T=n.offset(C),w=x.horizontal?X.pageX<T.left+n.width(C)/2:X.pageY<T.top+n.height(C)/2,x.$parentNodesScope.accept(r,x.index())?w?(C[0].parentNode.insertBefore(p[0],C[0]),s.moveTo(x.$parentNodesScope,x.siblings(),x.index())):(C.after(p),s.moveTo(x.$parentNodesScope,x.siblings(),x.index()+1)):!w&&x.accept(r,x.childNodesCount())&&(x.$childNodesScope.$element.append(p),s.moveTo(x.$childNodesScope,x.childNodes(),x.childNodesCount())))}r.$apply(function(){r.$callbacks.dragMove(s.eventArgs(m,u))})}},S=function(e){e.preventDefault(),$&&(r.$treeScope.$apply(function(){r.$callbacks.beforeDrop(s.eventArgs(m,u))}),f.replaceWith(r.$element),p.remove(),$.remove(),$=null,r.$$apply?r.$treeScope.$apply(function(){s.apply(),r.$callbacks.dropped(s.eventArgs(m,u))}):T(),r.$treeScope.$apply(function(){r.$callbacks.dragStop(s.eventArgs(m,u))}),r.$$apply=!1,s=null);var n=document.body.getAttribute("ui-tree-cursor");null!==n&&(o.find("body").css({cursor:n}),document.body.removeAttribute("ui-tree-cursor")),angular.element(o).unbind("touchend",x),angular.element(o).unbind("touchcancel",x),angular.element(o).unbind("touchmove",N),angular.element(o).unbind("mouseup",x),angular.element(o).unbind("mousemove",N),angular.element(t.document.body).unbind("mouseleave",C)},v=function(e){r.dragEnabled()&&b(e)},N=function(e){y(e)},x=function(e){r.$$apply=!0,S(e)},C=function(e){S(e)},E=function(){var e;return{exec:function(n,t){t||(t=0),this.cancel(),e=l(n,t)},cancel:function(){l.cancel(e)}}}(),T=function(){i.bind("touchstart mousedown",function(e){E.exec(function(){v(e)},r.dragDelay||0)}),i.bind("touchend touchcancel mouseup",function(){E.cancel()})},T(),w=function(e){27==e.keyCode&&(r.$$apply=!1,S(e))},angular.element(t.document.body).bind("keydown",w),r.$on("$destroy",function(){angular.element(t.document.body).unbind("keydown",w)})}}}])}(),function(){"use strict";angular.module("ui.tree").directive("uiTreeNodes",["treeConfig","$window",function(e){return{require:["ngModel","?^uiTreeNode","^uiTree"],restrict:"A",scope:!0,controller:"TreeNodesController",link:function(n,t,o,l){var r={},i=l[0],a=l[1],d=l[2];angular.extend(r,e),r.nodesClass&&t.addClass(r.nodesClass),a?(a.scope.$childNodesScope=n,n.$nodeScope=a.scope):d.scope.$nodesScope=n,n.$treeScope=d.scope,i&&(i.$render=function(){i.$modelValue&&angular.isArray(i.$modelValue)||(n.$modelValue=[]),n.$modelValue=i.$modelValue}),n.$watch(o.maxDepth,function(e){"number"==typeof e&&(n.maxDepth=e)}),n.$watch(function(){return o.nodropEnabled},function(e){"undefined"!=typeof e&&(n.nodropEnabled=!0)},!0),o.$observe("horizontal",function(e){n.horizontal="undefined"!=typeof e})}}}])}(),function(){"use strict";angular.module("ui.tree").factory("$uiTreeHelper",["$document","$window",function(e,n){return{nodesData:{},setNodeAttribute:function(e,n,t){if(!e.$modelValue)return null;var o=this.nodesData[e.$modelValue.$$hashKey];o||(o={},this.nodesData[e.$modelValue.$$hashKey]=o),o[n]=t},getNodeAttribute:function(e,n){if(!e.$modelValue)return null;var t=this.nodesData[e.$modelValue.$$hashKey];return t?t[n]:null},nodrag:function(e){return"undefined"!=typeof e.attr("data-nodrag")?"false"===e.attr("data-nodrag")?!1:!0:!1},eventObj:function(e){var n=e;return void 0!==e.targetTouches?n=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(n=e.originalEvent.targetTouches.item(0)),n},dragInfo:function(e){return{source:e,sourceInfo:{nodeScope:e,index:e.index(),nodesScope:e.$parentNodesScope},index:e.index(),siblings:e.siblings().slice(0),parent:e.$parentNodesScope,moveTo:function(e,n,t){this.parent=e,this.siblings=n.slice(0);var o=this.siblings.indexOf(this.source);o>-1&&(this.siblings.splice(o,1),this.source.index()<t&&t--),this.siblings.splice(t,0,this.source),this.index=t},parentNode:function(){return this.parent.$nodeScope},prev:function(){return this.index>0?this.siblings[this.index-1]:null},next:function(){return this.index<this.siblings.length-1?this.siblings[this.index+1]:null},isDirty:function(){return this.source.$parentNodesScope!=this.parent||this.source.index()!=this.index},eventArgs:function(e,n){return{source:this.sourceInfo,dest:{index:this.index,nodesScope:this.parent},elements:e,pos:n}},apply:function(){if(this.parent.$treeScope.nodropEnabled!==!0){var e=this.source.$modelValue;if(this.source.$treeScope.cloneEnabled!==!0&&this.source.remove(),this.source.$treeScope.cloneEnabled===!0&&this.source.$treeScope===this.parent.$treeScope)return!1;this.parent.insertNode(this.index,e)}}}},height:function(e){return e.prop("scrollHeight")},width:function(e){return e.prop("scrollWidth")},offset:function(t){var o=t[0].getBoundingClientRect();return{width:t.prop("offsetWidth"),height:t.prop("offsetHeight"),top:o.top+(n.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:o.left+(n.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}},positionStarted:function(e,n){var t={};return t.offsetX=e.pageX-this.offset(n).left,t.offsetY=e.pageY-this.offset(n).top,t.startX=t.lastX=e.pageX,t.startY=t.lastY=e.pageY,t.nowX=t.nowY=t.distX=t.distY=t.dirAx=0,t.dirX=t.dirY=t.lastDirX=t.lastDirY=t.distAxX=t.distAxY=0,t},positionMoved:function(e,n,t){n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=e.pageX,n.nowY=e.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:n.distX>0?1:-1,n.dirY=0===n.distY?0:n.distY>0?1:-1;var o=Math.abs(n.distX)>Math.abs(n.distY)?1:0;return t?(n.dirAx=o,void(n.moving=!0)):(n.dirAx!==o?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),void(n.dirAx=o))}}}])}();</script><script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script><script>!function(){"use strict";var app=angular.module("dcsummary",["ngAnimate","ui.bootstrap","ui.tree"]);app.filter("drugsStartingWith",function(){return function(items,startswith){var matching_items=[];if(items&&startswith){for(var i=0;i<items.length;i++)RegExp("^"+startswith,"i").test(items[i])&&matching_items.push(items[i]);return matching_items.sort()}return items}}),app.controller("body",["$scope",function($scope){$scope.users={doctor:{name:"John Watson",isPrescriber:!0,mcnz:12345},nurse:{name:"Jean Ratched",isPrescriber:!1},physio:{name:"Bruce Banner",isPrescriber:!1}},$scope.currentUser=$scope.users.doctor,$scope.date=new Date,$scope.patient={name:{first:"Eric Arthur",last:"Blair"},address:["221b Baker Street","Fairfield","Hamilton 3214","New Zealand"],phone:"027 999 4321",dob:new Date(1957,1,10),nhi:"LKJ1234"};var duration=moment.duration(new Date-$scope.patient.dob),i=Math.floor(duration.asYears());i>=2?$scope.patient.age=i+" years":(i=Math.floor(duration.asMonths()),i>=3?$scope.patient.age=i+" months":(i=Math.floor(duration.asWeeks()),i>=2?$scope.patient.age=i+" weeks":(i=Math.floor(duration.asDays()),1===i?$scope.patient.age="1 day":$scope.patient.age=i+" days"))),$scope.gp={name:"Dr G P Smith",address:["1600 Pennsylvania Avenue","Flagstaff","Hamilton 3210","New Zealand"],phone:"07 555 1234",fax:"07 432 7654"},$scope.admission={clinician:"Blue Team",service:"General Medicine",ward:"A2",admission_date:new Date(2015,4,23),discharge_date:new Date,los:function(){var days=Math.floor(moment.duration($scope.admission.discharge_date-$scope.admission.admission_date).asDays());return 1===days?"1 day":days+" days"}},$scope.today=function(){$scope.discharge_date=new Date},$scope.open=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.calendar.opened=!0},$scope.calendar={opened:!1,options:{formatYear:"yy",startingDay:1,showWeeks:"false",maxMode:"day"}},$scope.hospital={name:"Waikato Hospital",address:["Pembroke Street","Private Bag 3200","Hamilton 3240","New Zealand"]},$scope.functions={newItem:function(listname){$scope.diagnoses[listname].push({str:"",extras:[]})},newSubItem:function(scope){scope.$modelValue.extras.push({str:""}),scope.expand()},conditionalRemove:function(scope,minlength){scope.$parentNodesScope.$modelValue.length>minlength?scope.removeNode():(scope.$modelValue.str="",scope.$modelValue.extras=[])},newDrug:function(){$scope.drugs.push({rx:"",admission:"",discharge:"",mitte:"",status:"cont",include:!0})}},$scope.presentation="Came to hospital via ambulance.\nChest crackles heard.\nCT head performed.",$scope.progress="Treated for common cold.\nDeveloped acute psychosis.\nSettled with IV fluids.",$scope.plan="Started metformin.\nNot to drive for 6 months.\nOncology follow up in 2 years.",$scope.advice="Keep well hydrated.\nAvoid fatty foods.",$scope.drugStatusList=[{label:"Continued","short":"cont"},{label:"Stopped","short":"stop"},{label:"Changed","short":"change"},{label:"New","short":"new"}],$scope.rxFilter=function(drug){if(!drug.include||!drug.mitte||!drug.rx||"stop"===drug.status)return!1;switch(drug.status){case"cont":if(!drug.admission)return!1;break;case"change":if(!drug.admission||!drug.discharge)return!1;break;case"new":if(!drug.discharge)return!1}return!0},$scope.drugNames=["paracetamol","aspirin","amlodipine","atenolol","atorvastatin","azithromycin","diazepam","codeine","amoxicillin","allopurinol"],$scope.drugs=[{rx:"prednisone",admission:"5mg PO mane",discharge:"",mitte:"",status:"cont",include:!1},{rx:"amoxicillin",admission:"500mg PO TDS",discharge:"",mitte:"",status:"stop",include:!0},{rx:"allopurinol",admission:"300mg PO mane",discharge:"600mg PO mane",mitte:"2 weeks",status:"change",include:!0},{rx:"thyroxine",admission:"",discharge:"50mcg PO mane",mitte:"2 weeks",status:"new",include:!0}],$scope.specialAuthority=[{name:"Ticagrelor",number:123456789,expiry:"June 2015"},{name:"Enoxaparin",number:759472542,expiry:"May 2017"},{name:"peg-GCSF",number:649845623,expiry:"Lifetime"}],$scope.diagnoses={current:[{str:"NSTEMI",extras:[{str:"TIMI 3"},{str:"PCI to RCA"}]},{str:"AKI",extras:[]},{str:"UTI",extras:[{str:"Multi-resistant E. coli"}]}],background:[{str:"Ischaemic heart disease",extras:[{str:"STEMI 2007, PCI to LAD"},{str:"NSTEMI 2009"}]},{str:"Congestive heart failure",extras:[{str:"LVEF 30% 2009"}]},{str:"COPD",extras:[{str:"FEV1 30% predicted 2010"},{str:"Ex-smoker, 80 pack-year smoking history"}]},{str:"Type 2 diabetes",extras:[{str:"diet-controlled"}]},{str:"Chronic kidney disease stage IV",extras:[{str:"baseline creatinine 150"}]},{str:"Obstructive sleep apnoea",extras:[{str:"unable to tolerate BIPAP"}]},{str:"Dyslipidaemia",extras:[]},{str:"Depression",extras:[]},{str:"Bilateral total knee joint replacement",extras:[]},{str:"Osteoarthritis",extras:[]},{str:"Previous septic arthritis L elbow 2003",extras:[]}]}}])}();</script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"><style>.angular-ui-tree-empty{border:1px dashed #bbb;min-height:100px;background-color:#e5e5e5;background-image:-webkit-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff),-webkit-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff);background-image:-moz-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff),-moz-linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff);background-image:linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff),linear-gradient(45deg,#fff 25%,transparent 25%,transparent 75%,#fff 75%,#fff);background-size:60px 60px;background-position:0 0,30px 30px}.angular-ui-tree-nodes{display:block;position:relative;margin:0;padding:0;list-style:none}.angular-ui-tree-nodes .angular-ui-tree-nodes{padding-left:20px}.angular-ui-tree-node,.angular-ui-tree-placeholder{display:block;position:relative;margin:0;padding:0;min-height:20px;line-height:20px}.angular-ui-tree-hidden{display:none}.angular-ui-tree-placeholder{margin:5px 0;padding:0;min-height:30px}.angular-ui-tree-handle{cursor:move;text-decoration:none;font-weight:700;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;min-height:20px;line-height:20px}.angular-ui-tree-drag{position:absolute;pointer-events:none;z-index:999;opacity:.8}</style><style>.angular-ui-tree-handle{border:1px solid #dae2ea;padding:0 5px}.angular-ui-tree-handle:hover{color:#438eb9;background:#f4f6f7;border-color:#dce2e8}.angular-ui-tree-placeholder{background:#f0f9ff;border:2px dashed #bed2db;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}div[heading='Prescriptions'] ul,div[heading='Demographics'] ul{padding:0;list-style-type:none}div[heading='Prescriptions'] li.prescription{margin:10px 0}textarea{resize:vertical}#medtable input[type='text']:optional{display:none}input.ng-invalid,textarea.ng-invalid{background-color:#ffffe0}.nav,.pagination,.carousel,.panel-title a{cursor:pointer}</style></head><body ng-app="dcsummary" ng-controller="body"> <div class="container"> <h1>Discharge Summary</h1><form class="form-inline"> <div class="form-group"> <label for="selectUser">Current user</label> <div id="selectUser" class="btn-group"> <label class="btn btn-primary" ng-model="currentUser" btn-radio="users.doctor">Doctor</label> <label class="btn btn-primary" ng-model="currentUser" btn-radio="users.nurse">Nurse</label> <label class="btn btn-primary" ng-model="currentUser" btn-radio="users.physio">Physio</label> </div></div><div class="form-group"> <input ng-model="currentUser.name" class="form-control" id="userName" placeholder="Name"/> </div><div class="form-group"> <button type="button" class="btn btn-default" ng-model="currentUser.isPrescriber" btn-checkbox >Prescriber</button> </div><div ng-if="currentUser.isPrescriber" class="form-group"> <input ng-model="currentUser.mcnz" class="form-control" id="userMCNZ" type="number" placeholder="MCNZ"/> </div></form><accordion close-others="true" ng-form name="dcForm"> <accordion-group heading="Demographics"> <div class="row"> <dl id="patient" class="col-sm-4"> <dt>Patient</dt> <dd ng-bind="patient.name.first + ' ' + patient.name.last"></dd> <dt>Address</dt> <dd> <ul> <li ng-repeat="line in patient.address" ng-bind="line"></li></ul> </dd> <dt>Phone</dt> <dd ng-bind="patient.phone"></dd> <dt>Date of birth</dt> <dd id="dob" ng-bind="patient.dob | date:'longDate'"></dd> <dt>Age</dt> <dd id="age" ng-bind="patient.age"></dd> <dt>NHI</dt> <dd id="nhi" ng-bind="patient.nhi"></dd> </dl> <dl id="gp" class="col-sm-4"> <dt>GP</dt> <dd ng-bind="gp.name"></dd> <dt>Address</dt> <dd> <ul> <li ng-repeat="line in gp.address" ng-bind="line"></li></ul> </dd> <dt>Phone</dt> <dd ng-bind="gp.phone"></dd> <dt>Fax</dt> <dd ng-bind="gp.fax"></dd> </dl> <dl id="hospital" class="col-sm-4"> <dt>Hospital</dt> <dd ng-bind="hospital.name"></dd> <dt>Address</dt> <dd> <ul> <li ng-repeat="line in hospital.address" ng-bind="line"></li></ul> </dd> </dl> </div><div class="row"> <dl id="dates" class="col-sm-4"> <dt>Date of admission</dt> <dd id="adate" ng-bind="admission.admission_date | date:'fullDate'"></dd> <dt>Date of discharge</dt> <dd id="ddate" datepicker-popup ng-model="admission.discharge_date" is-open="calendar.opened" datepicker-options="calendar.options" min-date="admission.admission_date" show-button-bar="false"> <span ng-bind="admission.discharge_date | date:'fullDate'"></span> <button type="button" class="btn btn-default" ng-click="open($event)"><span class="glyphicon glyphicon-calendar"></span></button> </dd> <dt ng-show="admission.discharge_date">Admission duration</dt> <dd ng-show="admission.discharge_date" ng-bind="admission.los()"></dd> </dl> <dl id="admission" class="col-sm-4 col-sm-offset-4"> <dt>Clinician</dt> <dd id="clinician" ng-bind="admission.clinician"></dd> <dt>Service</dt> <dd id="service" ng-bind="admission.service"></dd> <dt>Ward</dt> <dd id="ward" ng-bind="admission.ward"></dd> </dl> </div></accordion-group> <accordion-group> <accordion-heading> Diagnoses <span class="badge">{{diagnoses.current.length || ''}}</span> </accordion-heading> <a class="btn btn-success btn-xs" ng-click="functions.newItem('current')"><span class="glyphicon glyphicon-plus"></span></a> <ol ui-tree ui-tree-nodes ng-model="diagnoses.current" class="list-group"> <li ng-repeat="diagnosis in diagnoses.current" ui-tree-node class="list-group-item"> <div ui-tree-handle class="bg-info"> <input class="diagnosis" data-nodrag ng-model="diagnosis.str"/> <a class="btn btn-danger btn-xs" data-nodrag ng-click="functions.conditionalRemove(this,1)"><span class="glyphicon glyphicon-remove"></span></a> <a class="btn btn-success btn-xs" data-nodrag ng-click="functions.newSubItem(this)"><span class="glyphicon glyphicon-pencil"></span></a> <a ng-if="diagnosis.extras.length" class="btn btn-info btn-xs" data-nodrag ng-click="this.toggle()"><span class="glyphicon" ng-class="{'glyphicon-plus': collapsed, 'glyphicon-minus': !collapsed}"></span></a> </div><ol ui-tree-nodes ng-model="diagnosis.extras" ng-class="{hidden: collapsed}"> <li ng-repeat="extra in diagnosis.extras" ui-tree-node> <div ui-tree-handle class="bg-success"> <input class="extra" data-nodrag ng-model="extra.str"/> <a class="btn btn-danger btn-xs" data-nodrag ng-click="this.remove()"><span class="glyphicon glyphicon-remove"></span></a> </div></ol> </li></ol> </accordion-group> <accordion-group> <accordion-heading> Background <span class="badge">{{diagnoses.background.length || ''}}</span> </accordion-heading> <a class="btn btn-success btn-xs" ng-click="functions.newItem('background')"><span class="glyphicon glyphicon-plus"></span></a> <ol ui-tree ui-tree-nodes ng-model="diagnoses.background" class="list-group"> <li ng-repeat="diagnosis in diagnoses.background" ui-tree-node class="list-group-item"> <div ui-tree-handle class="bg-info"> <input class="diagnosis" data-nodrag ng-model="diagnosis.str"/> <a class="btn btn-danger btn-xs" data-nodrag ng-click="functions.conditionalRemove(this,0)"><span class="glyphicon glyphicon-remove"></span></a> <a class="btn btn-success btn-xs" data-nodrag ng-click="functions.newSubItem(this)"><span class="glyphicon glyphicon-pencil"></span></a> <a ng-if="diagnosis.extras.length" class="btn btn-info btn-xs" data-nodrag ng-click="this.toggle()"><span class="glyphicon" ng-class="{'glyphicon-plus': collapsed, 'glyphicon-minus': !collapsed}"></span></a> </div><ol ui-tree-nodes ng-model="diagnosis.extras" ng-class="{hidden: collapsed}"> <li ng-repeat="extra in diagnosis.extras" ui-tree-node> <div ui-tree-handle class="bg-success"> <input class="extra" data-nodrag ng-model="extra.str"/> <a class="btn btn-danger btn-xs" data-nodrag ng-click="this.remove()"><span class="glyphicon glyphicon-remove"></span></a> </div></ol> </li></ol> </accordion-group> <accordion-group heading="Presentation" ng-form name="presentationForm" ng-class="{'panel-warning':presentationForm.$invalid}"> <textarea ng-model="presentation" placeholder="History/Examination/Investigations" class="form-control" rows="10" required></textarea> </accordion-group> <accordion-group heading="Inpatient progress" ng-form name="progressForm" ng-class="{'panel-warning':progressForm.$invalid}"> <textarea ng-model="progress" placeholder="Treatment/Response/Further issues" class="form-control" rows="10" required></textarea> </accordion-group> <accordion-group heading="Plan" ng-form name="planForm" ng-class="{'panel-warning':planForm.$invalid}"> <textarea ng-model="plan" class="form-control" rows="10" required></textarea> </accordion-group> <accordion-group heading="Advice to patient"> <textarea ng-model="advice" placeholder="Optional" class="form-control" rows="10"></textarea> </accordion-group> <accordion-group ng-show="currentUser.isPrescriber" ng-form name="drugForm" ng-class="{'panel-warning':drugForm.$invalid}"> <accordion-heading> Medications <span class="badge">{{drugs.length || ''}}</span> </accordion-heading> <a class="btn btn-success btn-xs" ng-click="functions.newDrug(this)"><span class="glyphicon glyphicon-plus"></span></a> <table id="medtable" class="table"> <thead> <tr> <th>Drug</th> <th>Admission</th> <th></th> <th>Discharge</th> <th>&#8478;</th> <th>Amount</th> <th></th> </tr></thead> <tbody> <tr ng-repeat="drug in drugs" ng-class="{{drug.status}}" class="drug" ng-form> <td><input class="form-control" required ng-model="drug.rx" typeahead="drug for drug in drugNames | drugsStartingWith:$viewValue | limitTo:5" type="text"/></td><td><input class="form-control" ng-required="drug.status !=='new'" ng-model="drug.admission" type="text"/></td><td><select ng-options="status.short as status.label for status in drugStatusList" ng-model="drug.status" required></select></td><td><input class="form-control" ng-required="drug.status !=='cont' && drug.status !=='stop'" ng-model="drug.discharge" type="text"/></td><td><input ng-hide="drug.status==='stop'" ng-model="drug.include" type="checkbox"/></td><td><input class="form-control" ng-required="drug.status !=='stop' && drug.include" ng-model="drug.mitte" type="text"/></td><td><a class="btn btn-danger btn-xs" ng-click="drugs.splice($index,1)"><span class="glyphicon glyphicon-remove"></span></a></td></tr></tbody> </table> </accordion-group> <accordion-group ng-show="currentUser.isPrescriber" heading="Prescriptions"> <div class="clearfix"> <ul class="pull-left"> <li ng-bind="patient.name.first + ' ' + patient.name.last"></li><li ng-repeat="line in patient.address" ng-bind="line"></li></ul> <ul class="pull-right text-right"> <li ng-bind="currentUser.name"></li><li ng-bind="'MCNZ: ' + currentUser.mcnz"></li><li ng-bind="hospital.name"></li><li ng-repeat="line in hospital.address" ng-bind="line"></li></ul> </div><hr/> <ul> <li ng-repeat="drug in drugs | filter : rxFilter" class="prescription">℞:{{drug.rx}}<br>Sig:{{drug.status==='cont' ? drug.admission : drug.discharge}}<br>Mitte:{{drug.mitte}}</li></ul> <hr/> <div> <div class="pull-left">Signed:</div><div class="pull-right" ng-bind="date | date:'fullDate'"></div></div></accordion-group> <accordion-group ng-show="currentUser.isPrescriber"> <accordion-heading> Current special authority numbers <span class="badge">{{specialAuthority.length || ''}}</span> </accordion-heading> <table class="table"> <tr> <th>Drug</th> <th>SA number</th> <th>Expiry</th> </tr><tr ng-repeat="item in specialAuthority"> <td ng-bind="item.name"></td><td ng-bind="item.number"></td><td ng-bind="item.expiry"></td></tr></table> </accordion-group> </accordion> <div ng-show="dcForm.$valid" class="btn-group dropup" dropdown> <button type="button" class="btn btn-default">Sign off and print</button> <button type="button" class="btn btn-default dropdown-toggle" dropdown-toggle> <span class="caret"></span> </button> <ul class="dropdown-menu"> <li><a href="#">Save and print</a></li><li><a href="#">Save and exit</a></li><li class="divider"></li><li><a href="#">Sign off and exit</a></li></ul> </div></div></body></html>